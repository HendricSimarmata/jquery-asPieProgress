/*! jQuery asPieProgress - v0.1.0 - 2014-09-04
* https://github.com/amazingSurge/jquery-asPieProgress
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a,b,c,d){"use strict";function e(a){return"string"==typeof a&&-1!=a.indexOf("%")}function f(){return c.performance.now?c.performance.now():Date.now()}Date.now||(Date.now=function(){return(new Date).getTime()});for(var g=["webkit","moz"],h=0;h<g.length&&!c.requestAnimationFrame;++h){var i=g[h];c.requestAnimationFrame=c[i+"RequestAnimationFrame"],c.cancelAnimationFrame=c[i+"CancelAnimationFrame"]||c[i+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(c.navigator.userAgent)||!c.requestAnimationFrame||!c.cancelAnimationFrame){var j=0;c.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(j+16,b);return setTimeout(function(){a(j=c)},c-b)},c.cancelAnimationFrame=clearTimeout}var k=function(c,d){var e=b.createElementNS("http://www.w3.org/2000/svg",c);return a.each(d,function(a,b){e.setAttribute(a,b)}),e},l="createElementNS"in b&&new k("svg",{}).createSVGRect,m="asPieProgress",n=a[m]=function(b,c){l&&(this.element=b,this.$element=a(b),this.options=a.extend({},n.defaults,c,this.$element.data()),this.namespace=this.options.namespace,this.classes={number:this.namespace+"__number",content:this.namespace+"__content"},this.$element.addClass(this.namespace),this.min=this.$element.attr("aria-valuemin"),this.max=this.$element.attr("aria-valuemax"),this.min=this.min?parseInt(this.min,10):this.options.min,this.max=this.max?parseInt(this.max,10):this.options.max,this.first=this.$element.attr("aria-valuenow"),this.first=this.first?parseInt(this.first,10):this.min,this.now=this.first,this.goal=this.options.goal,this._frameId=null,this.initialized=!1,this._trigger("init"),this.init())};n.defaults={namespace:"asPieProgress",min:0,max:100,goal:100,size:160,speed:15,barcolor:"#ef1e25",barsize:"4",trackcolor:"#f2f2f2",fillcolor:"none",numberCallback:function(a){var b=this.getPercentage(a);return b+"%"},contentCallback:null},n.prototype={constructor:n,init:function(){this.$number=this.$element.find("."+this.classes.number),this.$content=this.$element.find("."+this.classes.content),this.size=this.options.size,this.width=this.size,this.height=this.size,this.svg=new k("svg",{width:this.width,height:this.height}),this.buildTrack(),this.buildBar(),this.$element.append(this.svg),this.initialized=!0,this._trigger("ready")},buildTrack:function(){var a=this.size,b=this.size,c=a/2,d=b/2,e=this.options.barsize,f=new k("ellipse",{rx:c-e/2,ry:d-e/2,cx:c,cy:d,stroke:this.options.trackcolor,fill:this.options.fillcolor,"stroke-width":e});this.svg.appendChild(f)},buildBar:function(){var a=new k("path",{fill:"none","stroke-width":this.options.barsize,stroke:this.options.barcolor});this.bar=a,this.svg.appendChild(a),this._drawBar(this.goal),this._updateBar()},_drawBar:function(a){this.bar_goal=a;var b=this.size,c=this.size,d=b/2,e=c/2,f=0,g=this.options.barsize,h=Math.min(d,e)-g/2;this.r=h;var i=this.getPercentage(a);100===i&&(i-=1e-4);var j=f+i*Math.PI*2/100,k=d+h*Math.sin(f),l=e-h*Math.cos(f),m=d+h*Math.sin(j),n=e-h*Math.cos(j),o=0;j-f>Math.PI&&(o=1);var p="M"+k+","+l+" A"+h+","+h+" 0 "+o+" 1 "+m+","+n;this.bar.setAttribute("d",p)},_updateBar:function(){var a=this.getPercentage(this.now),b=this.bar.getTotalLength(),c=b*(1-a/this.getPercentage(this.bar_goal));this.bar.style.strokeDasharray=b+" "+b,this.bar.style.strokeDashoffset=c},_trigger:function(a){var b,c=arguments.length>1?Array.prototype.slice.call(arguments,1):d;c?(b=c,b.push(this)):b=this,this.$element.trigger(m+"::"+a,b),this.$element.trigger(a+"."+m,b),a=a.replace(/\b\w+\b/g,function(a){return a.substring(0,1).toUpperCase()+a.substring(1)});var e="on"+a;"function"==typeof this.options[e]&&this.options[e].apply(this,c)},getPercentage:function(a){return Math.round(100*(a-this.min)/(this.max-this.min))},go:function(a){var b=this;this._clear(),e(a)&&(a=parseInt(a.replace("%",""),10),a=Math.round(this.min+a/100*(this.max-this.min))),"undefined"==typeof a&&(a=this.goal),a>this.max?a=this.max:a<this.min&&(a=this.min),this.bar_goal<a&&this._drawBar(a);var d=b.now,g=f(),h=function(e){var f=(e-g)/b.options.speed,i=Math.round(f/100*(b.max-b.min));a>d?(i=d+i,i>a&&(i=a)):(i=d-i,a>i&&(i=a)),b._update(i),i===a?(c.cancelAnimationFrame(b._frameId),b._frameId=null,b.now===b.goal&&b._trigger("finish")):b._frameId=c.requestAnimationFrame(h)};b._frameId=c.requestAnimationFrame(h)},_update:function(a){this.now=a,this._updateBar(),this.$element.attr("aria-valuenow",this.now),this.$number.length>0&&"function"==typeof this.options.numberCallback&&this.$number.html(this.options.numberCallback.call(this,[this.now])),this.$content.length>0&&"function"==typeof this.options.contentCallback&&this.$content.html(this.options.contentCallback.call(this,[this.now])),this._trigger("update",a)},_clear:function(){this._frameId&&(c.cancelAnimationFrame(this._frameId),this._frameId=null)},get:function(){return this.now},start:function(){this._clear(),this._trigger("start"),this.go(this.goal)},reset:function(){this._clear(),this._drawBar(this.goal),this._update(this.first),this._trigger("reset")},stop:function(){this._clear(),this._trigger("stop")},finish:function(){this._clear(),this._update(this.goal),this._trigger("finish")},destory:function(){this.$element.data(m,null),this._trigger("destory")}},a.fn[m]=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,m)||a.data(this,m,new n(this,b))});var c=b,e=arguments.length>1?Array.prototype.slice.call(arguments,1):d;if(/^\_/.test(c))return!1;if(!/^(get)$/.test(c))return this.each(function(){var b=a.data(this,m);b&&"function"==typeof b[c]&&b[c].apply(b,e)});var f=this.first().data(m);return f&&"function"==typeof f[c]?f[c].apply(f,e):void 0}}(jQuery,document,window);